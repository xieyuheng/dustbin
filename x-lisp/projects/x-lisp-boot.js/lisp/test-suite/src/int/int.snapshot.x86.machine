(export _setup _main)

(define-code square
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (subq (imm 32) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -8))
    (movq (label-deref (label imul©constant)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -16))
    (movq (reg-deref (reg rbp) -16) (reg rdi))
    (movq (reg-deref (reg rbp) -8) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -24))
    (movq (reg-deref (reg rbp) -24) (reg rdi))
    (movq (reg-deref (reg rbp) -8) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -32))
    (movq (reg-deref (reg rbp) -32) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 32) (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data square©metadata
  (pointer square©metadata/name)
  (int 1)
  (int 0)
  (pointer square©variable-info)
  (pointer square)
  (pointer square/end))

(define-data square©metadata/name (string "square"))

(define-space square©constant 8)

(define-code square©setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (subq (imm 32) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-imm (label square))
     (reg-deref (reg rbp) -8))
    (orq (imm 3) (reg-deref (reg rbp) -8))
    (movq
     (label-imm (label square©metadata))
     (reg-deref (reg rbp) -16))
    (orq (imm 3) (reg-deref (reg rbp) -16))
    (movq (reg-deref (reg rbp) -8) (reg rdi))
    (movq (reg-deref (reg rbp) -16) (reg rsi))
    (callq-n (external-label x-make-function) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -24))
    (movq (reg-deref (reg rbp) -24) (reg rax))
    (movq (reg rax) (label-deref (label square©constant)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 32) (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code _main
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (subq (imm 48) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-deref (label println-non-void©constant))
     (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -8))
    (movq (label-deref (label square©constant)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -16))
    (movq (imm 24) (reg-deref (reg rbp) -24))
    (movq (reg-deref (reg rbp) -16) (reg rdi))
    (movq (reg-deref (reg rbp) -24) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -32))
    (movq (reg-deref (reg rbp) -8) (reg rdi))
    (movq (reg-deref (reg rbp) -32) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -40))
    (movq (reg-deref (reg rbp) -40) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 48) (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data _main©metadata
  (pointer _main©metadata/name)
  (int 0)
  (int 0)
  (pointer _main©variable-info)
  (pointer _main)
  (pointer _main/end))

(define-data _main©metadata/name (string "_main"))

(define-space _main©constant 8)

(define-code _main©setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (subq (imm 32) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (label-imm (label _main)) (reg-deref (reg rbp) -8))
    (orq (imm 3) (reg-deref (reg rbp) -8))
    (movq
     (label-imm (label _main©metadata))
     (reg-deref (reg rbp) -16))
    (orq (imm 3) (reg-deref (reg rbp) -16))
    (movq (reg-deref (reg rbp) -8) (reg rdi))
    (movq (reg-deref (reg rbp) -16) (reg rsi))
    (callq-n (external-label x-make-function) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -24))
    (movq (reg-deref (reg rbp) -24) (reg rax))
    (movq (reg rax) (label-deref (label _main©constant)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 32) (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data println-non-void©metadata
  (pointer println-non-void©metadata/name)
  (int 1)
  (int 1)
  (int 0)
  (int 0)
  (int 0))

(define-data println-non-void©metadata/name
  (string "println-non-void"))

(define-space println-non-void©constant 8)

(define-code println-non-void©setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (subq (imm 32) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-imm (external-label x-println-non-void))
     (reg-deref (reg rbp) -8))
    (orq (imm 3) (reg-deref (reg rbp) -8))
    (movq
     (label-imm (label println-non-void©metadata))
     (reg-deref (reg rbp) -16))
    (orq (imm 3) (reg-deref (reg rbp) -16))
    (movq (reg-deref (reg rbp) -8) (reg rdi))
    (movq (reg-deref (reg rbp) -16) (reg rsi))
    (callq-n (external-label x-make-function) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -24))
    (movq (reg-deref (reg rbp) -24) (reg rax))
    (movq
     (reg rax)
     (label-deref (label println-non-void©constant)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 32) (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data imul©metadata
  (pointer imul©metadata/name)
  (int 2)
  (int 1)
  (int 0)
  (int 0)
  (int 0))

(define-data imul©metadata/name (string "imul"))

(define-space imul©constant 8)

(define-code imul©setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (subq (imm 32) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-imm (external-label x-imul))
     (reg-deref (reg rbp) -8))
    (orq (imm 3) (reg-deref (reg rbp) -8))
    (movq
     (label-imm (label imul©metadata))
     (reg-deref (reg rbp) -16))
    (orq (imm 3) (reg-deref (reg rbp) -16))
    (movq (reg-deref (reg rbp) -8) (reg rdi))
    (movq (reg-deref (reg rbp) -16) (reg rsi))
    (callq-n (external-label x-make-function) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -24))
    (movq (reg-deref (reg rbp) -24) (reg rax))
    (movq (reg rax) (label-deref (label imul©constant)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 32) (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data make-function©metadata
  (pointer make-function©metadata/name)
  (int 2)
  (int 1)
  (int 0)
  (int 0)
  (int 0))

(define-data make-function©metadata/name
  (string "make-function"))

(define-space make-function©constant 8)

(define-code make-function©setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (subq (imm 32) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-imm (external-label x-make-function))
     (reg-deref (reg rbp) -8))
    (orq (imm 3) (reg-deref (reg rbp) -8))
    (movq
     (label-imm (label make-function©metadata))
     (reg-deref (reg rbp) -16))
    (orq (imm 3) (reg-deref (reg rbp) -16))
    (movq (reg-deref (reg rbp) -8) (reg rdi))
    (movq (reg-deref (reg rbp) -16) (reg rsi))
    (callq-n (external-label x-make-function) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -24))
    (movq (reg-deref (reg rbp) -24) (reg rax))
    (movq
     (reg rax)
     (label-deref (label make-function©constant)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 32) (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data _function_table
  (int 1)
  (pointer _function_table/entries))

(define-data _function_table/entries
  (pointer square©metadata))

(define-code _setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (subq (imm 16) (reg rsp))
    (jmp (label body)))
  (block body
    (callq-n (label square©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -8))
    (callq-n (label _main©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -8))
    (callq-n (label println-non-void©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -8))
    (callq-n (label imul©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -8))
    (callq-n (label make-function©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -8)))
  (block epilog
    (addq (imm 16) (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data square©variable-info
  (int 4)
  (pointer square©variable-info/names))

(define-data square©variable-info/names
  (pointer square©variable-info/names/0)
  (pointer square©variable-info/names/1)
  (pointer square©variable-info/names/2)
  (pointer square©variable-info/names/3))

(define-data square©variable-info/names/0 (string "x"))

(define-data square©variable-info/names/1 (string "_₁"))

(define-data square©variable-info/names/2 (string "_₂"))

(define-data square©variable-info/names/3 (string "_↩"))

(define-data square©setup©variable-info
  (int 3)
  (pointer square©setup©variable-info/names))

(define-data square©setup©variable-info/names
  (pointer square©setup©variable-info/names/0)
  (pointer square©setup©variable-info/names/1)
  (pointer square©setup©variable-info/names/2))

(define-data square©setup©variable-info/names/0
  (string "address"))

(define-data square©setup©variable-info/names/1
  (string "metadata"))

(define-data square©setup©variable-info/names/2
  (string "function"))

(define-data _main©variable-info
  (int 5)
  (pointer _main©variable-info/names))

(define-data _main©variable-info/names
  (pointer _main©variable-info/names/0)
  (pointer _main©variable-info/names/1)
  (pointer _main©variable-info/names/2)
  (pointer _main©variable-info/names/3)
  (pointer _main©variable-info/names/4))

(define-data _main©variable-info/names/0 (string "_₁"))

(define-data _main©variable-info/names/1 (string "_₂"))

(define-data _main©variable-info/names/2 (string "_₃"))

(define-data _main©variable-info/names/3 (string "_₄"))

(define-data _main©variable-info/names/4 (string "_↩"))

(define-data _main©setup©variable-info
  (int 3)
  (pointer _main©setup©variable-info/names))

(define-data _main©setup©variable-info/names
  (pointer _main©setup©variable-info/names/0)
  (pointer _main©setup©variable-info/names/1)
  (pointer _main©setup©variable-info/names/2))

(define-data _main©setup©variable-info/names/0
  (string "address"))

(define-data _main©setup©variable-info/names/1
  (string "metadata"))

(define-data _main©setup©variable-info/names/2
  (string "function"))

(define-data println-non-void©setup©variable-info
  (int 3)
  (pointer println-non-void©setup©variable-info/names))

(define-data println-non-void©setup©variable-info/names
  (pointer println-non-void©setup©variable-info/names/0)
  (pointer println-non-void©setup©variable-info/names/1)
  (pointer println-non-void©setup©variable-info/names/2))

(define-data println-non-void©setup©variable-info/names/0
  (string "address"))

(define-data println-non-void©setup©variable-info/names/1
  (string "metadata"))

(define-data println-non-void©setup©variable-info/names/2
  (string "function"))

(define-data imul©setup©variable-info
  (int 3)
  (pointer imul©setup©variable-info/names))

(define-data imul©setup©variable-info/names
  (pointer imul©setup©variable-info/names/0)
  (pointer imul©setup©variable-info/names/1)
  (pointer imul©setup©variable-info/names/2))

(define-data imul©setup©variable-info/names/0
  (string "address"))

(define-data imul©setup©variable-info/names/1
  (string "metadata"))

(define-data imul©setup©variable-info/names/2
  (string "function"))

(define-data make-function©setup©variable-info
  (int 3)
  (pointer make-function©setup©variable-info/names))

(define-data make-function©setup©variable-info/names
  (pointer make-function©setup©variable-info/names/0)
  (pointer make-function©setup©variable-info/names/1)
  (pointer make-function©setup©variable-info/names/2))

(define-data make-function©setup©variable-info/names/0
  (string "address"))

(define-data make-function©setup©variable-info/names/1
  (string "metadata"))

(define-data make-function©setup©variable-info/names/2
  (string "function"))

(define-data _setup©variable-info
  (int 1)
  (pointer _setup©variable-info/names))

(define-data _setup©variable-info/names
  (pointer _setup©variable-info/names/0))

(define-data _setup©variable-info/names/0 (string "_"))
